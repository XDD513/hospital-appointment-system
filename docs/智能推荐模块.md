# 智能推荐系统实现方案

## 📊 方案对比分析

### 方案一：使用AI SDK（推荐）✅

#### 优势
1. **快速上线**：无需训练数据，接入即可使用
2. **成本可控**：按调用量付费，初期成本低
3. **维护简单**：无需维护模型，API调用即可
4. **效果稳定**：大厂模型经过大量数据训练，效果有保障
5. **技术门槛低**：Java调用HTTP API即可，无需ML专业知识

#### 劣势
1. **依赖外部服务**：需要网络连接，存在服务不稳定风险
2. **数据隐私**：数据需要发送到第三方（但可选用私有化部署方案）
3. **长期成本**：调用量大时成本可能较高
4. **定制化有限**：无法完全针对中医领域深度定制

#### 适用场景
- ✅ 中小型项目（数据量<10万）
- ✅ 快速迭代需求
- ✅ 团队缺少ML专家
- ✅ 预算有限

---

### 方案二：自己训练模型

#### 优势
1. **高度定制化**：完全针对中医业务场景优化
2. **数据隐私**：数据不出本地，隐私安全
3. **长期成本**：一次性投入，长期使用成本低
4. **可控性强**：完全自主控制，不受第三方限制

#### 劣势
1. **数据要求高**：需要大量标注数据（至少10万+条）
2. **技术门槛高**：需要ML/DL专业知识
3. **开发周期长**：数据准备、模型训练、调优需要数月
4. **基础设施要求**：需要GPU服务器、训练环境
5. **维护成本高**：需要持续优化和更新模型
6. **初期投入大**：人力、硬件、时间成本高

#### 适用场景
- ✅ 大型项目（数据量>100万）
- ✅ 有专业ML团队
- ✅ 数据隐私要求极高
- ✅ 长期运营，有充足预算

---

## 🎯 针对本项目的建议

### 推荐方案：**混合推荐系统（规则推荐 + AI增强）**

基于项目现状分析：
- 项目规模：中等规模中医健康系统
- 现有推荐：基于规则的体质匹配推荐
- 技术栈：Spring Boot + Vue，无ML基础设施
- 业务特点：中医领域，需要专业知识

### 实施策略

#### 阶段一：AI SDK增强（1-2周）
1. **集成大模型API**（推荐：阿里云通义千问、百度文心一言、腾讯混元）
2. **智能推荐场景**：
    - 对话中的智能回复建议
    - 基于用户对话内容的个性化推荐
    - 药膳推荐理由生成
    - 养生建议个性化文案

#### 阶段二：混合推荐优化（2-4周）
1. **规则推荐**（现有）：基于体质的精准匹配
2. **AI推荐**（新增）：基于用户行为、对话内容的智能推荐
3. **融合策略**：规则推荐为主，AI推荐为辅，动态调整权重

#### 阶段三：数据积累（长期）
1. 收集用户行为数据
2. 记录推荐效果反馈
3. 为未来自训练模型做准备

---

## 🛠️ 技术实现方案

### 1. AI SDK选型建议

#### 国内大模型对比

| 厂商 | 模型 | 优势 | 价格 | 推荐度 |
|------|------|------|------|--------|
| 阿里云 | 通义千问 | 企业级稳定，中医知识库丰富 | 中等 | ⭐⭐⭐⭐⭐ |
| 百度 | 文心一言 | 中文理解强，医疗领域有积累 | 中等 | ⭐⭐⭐⭐ |
| 腾讯 | 混元 | 性价比高，API友好 | 较低 | ⭐⭐⭐⭐ |
| 讯飞 | 星火 | 语音交互强 | 中等 | ⭐⭐⭐ |
| 智谱AI | GLM | 开源友好，可私有化 | 较低 | ⭐⭐⭐⭐ |

**推荐：阿里云通义千问**（企业级稳定，中医领域支持好）

### 2. 推荐场景设计

#### 场景1：对话智能推荐
```java
// 用户发送消息后，AI分析内容，推荐相关药膳/穴位
用户："最近总是失眠，有什么好的调理方法吗？"
AI推荐：
  - 推荐药膳：酸枣仁粥、百合莲子汤
  - 推荐穴位：神门穴、三阴交
  - 推荐医生：擅长失眠调理的医生列表
```

#### 场景2：个性化推荐理由
```java
// 为规则推荐的结果生成个性化推荐理由
规则推荐：根据体质推荐"黄芪炖鸡"
AI增强：生成推荐理由
"根据您的气虚体质，推荐这道黄芪炖鸡。黄芪补气健脾，鸡肉温中益气，
特别适合您当前的身体状况。建议每周食用2-3次，配合适量运动效果更佳。"
```

#### 场景3：智能问答助手
```java
// 在对话中提供智能问答支持
用户："阴虚体质适合吃什么？"
AI回复：基于中医知识库，提供专业回答
```

### 3. 架构设计

```
┌─────────────────┐
│   前端 Vue 3    │
└────────┬────────┘
         │
┌────────▼────────────────────────┐
│   Spring Boot 后端              │
│                                 │
│  ┌──────────────────────────┐  │
│  │  推荐服务层               │  │
│  │  - 规则推荐（现有）       │  │
│  │  - AI推荐（新增）         │  │
│  │  - 混合推荐策略           │  │
│  └──────────┬───────────────┘  │
│             │                   │
│  ┌──────────▼───────────────┐  │
│  │  AI服务封装层            │  │
│  │  - 通义千问SDK           │  │
│  │  - 请求封装/重试         │  │
│  │  - 结果缓存              │  │
│  └──────────┬───────────────┘  │
└─────────────┼───────────────────┘
              │
      ┌───────▼────────┐
      │  阿里云API      │
      │  通义千问       │
      └────────────────┘
```

### 4. 实现步骤

#### Step 1: 添加依赖（pom.xml）
```xml
<!-- 阿里云SDK -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>dashscope-sdk-java</artifactId>
    <version>2.8.0</version>
</dependency>

<!-- HTTP客户端（如果使用REST API） -->
<dependency>
    <groupId>com.squareup.okhttp3</groupId>
    <artifactId>okhttp</artifactId>
    <version>4.11.0</version>
</dependency>
```

#### Step 2: 创建AI服务接口
```java
@Service
public class AiRecommendationService {
    
    /**
     * 基于用户对话内容推荐药膳
     */
    public List<HerbalRecipe> recommendByConversation(
        String conversationContent, 
        Long userId
    );
    
    /**
     * 生成个性化推荐理由
     */
    public String generateRecommendationReason(
        HerbalRecipe recipe, 
        UserConstitutionTest constitution
    );
    
    /**
     * 智能问答
     */
    public String answerQuestion(String question, Long userId);
}
```

#### Step 3: 集成到现有推荐服务
```java
@Service
public class HerbalRecipeServiceImpl {
    
    @Autowired
    private AiRecommendationService aiService;
    
    @Override
    public Result<IPage<HerbalRecipe>> getRecommendedRecipes(...) {
        // 1. 规则推荐（现有逻辑）
        IPage<HerbalRecipe> ruleBased = ...;
        
        // 2. AI增强：生成推荐理由
        for (HerbalRecipe recipe : ruleBased.getRecords()) {
            String reason = aiService.generateRecommendationReason(
                recipe, constitution
            );
            recipe.setRecommendationReason(reason);
        }
        
        // 3. 可选：AI推荐补充
        if (ruleBased.getTotal() < pageSize) {
            List<HerbalRecipe> aiRecommended = aiService
                .recommendByConversation(conversationHistory, userId);
            // 合并结果...
        }
        
        return Result.success(ruleBased);
    }
}
```

### 5. 成本估算

#### 阿里云通义千问定价（参考）
- **qwen-turbo**：0.008元/千tokens（输入），0.008元/千tokens（输出）
- **qwen-plus**：0.02元/千tokens（输入），0.02元/千tokens（输出）

#### 场景成本估算
假设每天1000次推荐请求，每次平均500 tokens：

**日成本**：
- qwen-turbo: 1000 × 500 × 0.008 / 1000 = 4元/天
- **月成本**: 约120元/月

**年成本**: 约1440元/年

相比自训练模型（需要GPU服务器、ML工程师），成本极低。

---

## 📋 实施计划

### 第一阶段：基础集成（1-2周）
- [ ] 注册阿里云账号，开通通义千问服务
- [ ] 添加SDK依赖
- [ ] 创建AI服务封装类
- [ ] 实现基础推荐理由生成功能
- [ ] 单元测试

### 第二阶段：功能扩展（2-3周）
- [ ] 对话智能推荐
- [ ] 智能问答助手
- [ ] 推荐结果缓存优化
- [ ] 异常处理和降级策略

### 第三阶段：优化迭代（持续）
- [ ] 收集用户反馈
- [ ] 优化Prompt工程
- [ ] 性能优化
- [ ] A/B测试推荐效果

---

## ⚠️ 注意事项

### 1. 数据隐私
- 敏感信息脱敏处理
- 考虑使用私有化部署版本（如通义千问企业版）
- 遵守医疗数据相关法规

### 2. 降级策略
- AI服务不可用时，回退到规则推荐
- 设置超时和重试机制
- 缓存常用推荐结果

### 3. 成本控制
- 合理使用缓存，减少API调用
- 设置每日调用上限
- 监控API使用量

### 4. 效果评估
- 跟踪推荐点击率
- 收集用户反馈
- 定期优化推荐策略

---

## 🎯 总结

**推荐使用AI SDK方案**，原因：

1. ✅ **快速上线**：1-2周即可完成基础功能
2. ✅ **成本可控**：月成本约100-200元
3. ✅ **技术门槛低**：Java开发即可，无需ML专家
4. ✅ **效果稳定**：大厂模型，效果有保障
5. ✅ **易于迭代**：可以快速调整和优化

**未来规划**：
- 先使用AI SDK快速实现功能
- 积累用户数据和反馈
- 当数据量足够大时（10万+），再考虑自训练模型
- 形成"规则推荐 + AI推荐 + 自训练模型"的三层推荐体系

---

**最后更新**: 2025-01-XX
**版本**: v1.0.0
